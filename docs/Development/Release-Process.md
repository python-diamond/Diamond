# Release Process

From early on, Diamond was run as a master is stable release style. The belief was that master should always be stable and ready to deploy to production. This lead to the odd release system we currently have.

## Version String

The current version is generated by the bash script at https://github.com/python-diamond/Diamond/blob/master/version.sh

The major and minor version numbers are generated based on the latest annotated tag.

Cutting a new major/minor version is done via:

```shell
git tag -a v4.1 -m "foobar"
git push origin --tags
```

From this point forward, the makefile will generate a version starting with 4.1

The point release is then generated via the count of the number of commits from the latest tag to HEAD. This gave us a simple, always incrementing version number that allowed us to track back exactly where a package was generated from the origin.

However, this has caused issues where anyone building a package from a different origin/fork would have mismatched version numbers. This was intended to be fixed via adding the short hash to the version string, however this proved brittle, as RPMs and DEBs failed to build properly with the changed version string.

Testing the version code can be done via

```shell
make vertest
```

This will build the version.txt file and echo out it's contents

## pypi

The pypi package can be found at https://pypi.python.org/pypi/diamond

Currently the three maintainers are:

- kormoc
- mattrobenolt
- savant
 
I am happy to add anyone who should have the ability to cut releases.

I would use the `make  pypi` command to upload a new release. 

This used to run a version update and then `python setup.py sdist upload`.

Recently mattrobenolt updated the code to use https://pypi.python.org/pypi/twine , which is a much safer solution.

I believe both still require configuring `~/.pypirc` with something similar to:

```ini
[distutils]
index-servers =
    pypi

[pypi]
username:foo
password:bar
```

Currently once a new version is uploaded, we 'hide' old versions. They can still be reterived by specifying the version directly, however they won't show up as available unless you know the full version string.
